<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>支付</title>
    <meta charset="utf-8">
    <!-- 禁止用户手动缩放，最大缩放比例为1 -->
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <!-- 启用360浏览器的极速模式(webkit) -->
    <meta name="renderer" content="webkit">
    <!-- 避免IE使用兼容模式 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        body {
            width: 100%;
        }

        .pay-form {
            display: none;
        }

        .img-wrapper {
            display: none;
            height: 100%;
            width: 100%;

            background-color: #000;
            opacity: .5;
            text-align: right;
        }
        img.notice {
            margin: 10px 20px;
            width: 50%;
        }
    </style>
</head>
<body>
    <div class="pay-form">
        <form id="form" action="" method="post">
            <!-- 币种 -->
            <!--<input type="text" name="CurrencyCode" v-model="payFormData.currencyCode">-->
            <!-- 交易类型 -->
            <input id="TxnType" type="text" name="TxnType" value="">
            <!-- 合作方id -->
            <input id="PartnerID" type="text" name="PartnerID" value="">
            <!-- 支付方式id -->
            <input id="ChannelID" type="text" name="ChannelID" value="">
            <!-- 商户流水号 -->
            <input id="MerchantTxnNo" type="text" name="MerchantTxnNo" value="">
            <!-- 商户id -->
            <input id="MerchantID" type="text" name="MerchantID" value="">
            <!-- 支付说明 -->
            <input id="TxnAmt" type="text" name="TxnAmt" value="">
            <!-- 支付结果回调地址 -->
            <input id="RedirectUrl" type="text" name="RedirectUrl" value="">
            <!-- 交易说明 -->
            <input id="TxnShortDesc" type="text" name="TxnShortDesc" value="">
            <!-- 签名串 -->
            <input id="Sign" type="text" name="Sign" value="">
            <!-- 异步通知url -->
            <input id="NotifyUrl" type="text" name="NotifyUrl" value="">
        </form>
    </div>

    <div class="img-wrapper" id="img-notice">
        <img id="notice" class="notice" src="../../src/assets/images/open-in-browser.svg" alt="">
    </div>

    <script>
        /**
         * 获取url的参数
         * @param url
         * @returns {Array}
         */
        function getUrlString (url) {
            let obj = {};
            if(url.indexOf('?') !== -1){
                let query = url.split("?")[1];
                let queryArr = query.split("&");
                queryArr.forEach(function(item){
                    let key = item.split("=")[0];
                    let value = item.split("=")[1];
                    obj[key] = value;
                });
            }
            return obj;
        }

        /**
         * 判断是否在微信浏览器
         */
        function isWeixin () {
            let ua = navigator.userAgent.toLowerCase();
            let isWeixin = ua.indexOf('micromessenger') != -1;
            if (isWeixin) {
                return true;
            } else {
                return false;
            }
        }

        window.onload = function () {
            document.body.style.height = window.screen.height + 'px';

            if (isWeixin()) {
                //微信环境内
                document.getElementById('img-notice').style.display = 'block';
            } else {
                //非微信环境内 直接提交表单
                let params = getUrlString(decodeURI(location.href));
                let formDom = document.getElementById('form');
                let payFormData = JSON.parse(params.payFormData);

                //设置表单数据
                formDom.action = payFormData.payWebUrl;
                document.getElementById('TxnType').value = payFormData.txnType;
                document.getElementById('PartnerID').value = payFormData.partnerId;
                document.getElementById('ChannelID').value = payFormData.channelId;
                document.getElementById('MerchantTxnNo').value = payFormData.merchantTxnNo;
                document.getElementById('MerchantID').value = payFormData.merchantId;
                document.getElementById('TxnAmt').value = payFormData.txnAmt;
                document.getElementById('RedirectUrl').value = payFormData.redirectUrl;
                document.getElementById('TxnShortDesc').value = payFormData.txnShortDesc;
                document.getElementById('Sign').value = payFormData.sign;
                document.getElementById('NotifyUrl').value = payFormData.notifyUrl;
                formDom.submit();
            }
            location.href = location.origin + '/#/paySuccess'


        }
    </script>
</body>
</html>
